search:
  context: &context
    $ref: "./context.yaml"
  message:
    intent:
      category:
        descriptor:
          code:
            $ref: './provider.yaml#/category_codes'
      descriptor:
        $ref: './category.yaml#/intente_descriptor'

            
on_search:
  context: *context
  message:
    catalog:
      providers:
        categories:
          descriptor:
            code:
              $ref: "./provider.yaml#/category_codes"
        items: &item
          descriptor:
            code:
              $ref: "./item.yaml#/codes"
        fulfillments: &fulfillment_basic
          type:
            $ref: "./fulfillment.yaml#/type"

select:
  context: *context
  message:
    order: &order
      items:
        <<: *item
        quantity:
          selected:
            measure:
              unit:
                $ref: "./item.yaml#/units"
      fulfillments: *fulfillment_basic
      payments: &payment_basic
        collected_by:
          $ref: "./payment.yaml#/collected_by"
        type:
          $ref: "./payment.yaml#/type"
      xinput: &xinput_basic
        form_response:
          status:
            $ref: "./xinput.yaml#/form_response_status"

on_select:
  context: *context
  message:
    order: &order_select
      <<: *order
      fulfillments: *fulfillment_basic
      payments: *payment_basic
      xinput: *xinput_basic
      quote: &quote_basic
        price:
          currency:
            $ref: "./quote.yaml#/currency"
        breakup:
          title:
            $ref: "./quote.yaml#/title"

init:
  context: *context
  message:
    order: &order1
      <<: *order
      payments: &payment
        $ref: "./payment.yaml"
      fulfillments:
        <<: *fulfillment_basic
      xinput: *xinput_basic

on_init:
  context: *context
  message:
    order: &order2
      <<: *order1
      status:
        $ref: './order.yaml#/status'
      fulfillments:
        <<: *fulfillment_basic
      payments: *payment_basic
      xinput: *xinput_basic
      quote: *quote_basic

confirm:
  context: *context
  message:
    order: &order_confirm
      <<: *order2
      fulfillments: *fulfillment_basic
      payments: *payment_basic
      xinput: *xinput_basic

on_confirm:
  context: *context
  message:
    order: &order3
      <<: *order2
      fulfillments:
        type:
          $ref: "./fulfillment.yaml#/type"
        state:
          $ref: "./fulfillment.yaml#/state"
        customer:
          person:
            creds:
              type:
                $ref: "./fulfillment.yaml#/customer/person/creds/type"
        agent:
          organization:
            creds:
              type:
                $ref: "./fulfillment.yaml#/agent/organization/creds/type"
      payments:
        collected_by:
          $ref: "./payment.yaml#/collected_by"
        status:
          $ref: "./payment.yaml#/status"
        type:
          $ref: "./payment.yaml#/type"
      xinput:
        form_response:
          status:
            $ref: "./xinput.yaml#/form_response_status"
      quote: *quote_basic

on_status:
  context: *context
  message:
    order: &order4
      <<: *order3

on_update:
  context: *context
  message:
    order: &order5
      <<: *order4

update:
  context: *context
  message:
    order:
      fulfillments:
        type:
          $ref: "./fulfillment.yaml#/type"
        state:
          $ref: "./fulfillment.yaml#/state"
        customer:
          person:
            creds:
              type:
                $ref: "./fulfillment.yaml#/customer/person/creds/type"
        agent:
          organization:
            creds:
              type:
                $ref: "./fulfillment.yaml#/agent/organization/creds/type"
      payments: *payment_basic
      xinput: *xinput_basic
